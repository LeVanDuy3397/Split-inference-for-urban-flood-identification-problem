<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>Gửi ảnh hoặc video và vị trí • Bản đồ ngập</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <div class="header">
        <div>
            <h1>Gửi ảnh và vị trí</h1>
            <div class="sub">Gửi dữ liệu, xem điểm ngập theo thời gian thực, lọc hiển thị theo mức ngập.</div>
        </div>
        <div>
            <button id="btnClearFilter" class="btn ghost">Xóa lọc</button>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <div class="row">
                <h2>Gửi ảnh</h2>
                <div class="stack">
                    <div>
                        <input type="file" id="imageInput" accept="image/*" />
                        <button id="btnSendImage" class="btn primary">Gửi ảnh</button>
                    </div>
                    <div id="imgStatus" class="status"></div>
                </div>
            </div>

            <div class="row">
                <h2>Gửi video</h2>
                <div class="stack">
                    <div>
                        <input type="file" id="videoInput" accept="video/*" />
                        <button id="btnSendVideo" class="btn primary">Gửi video</button>
                    </div>
                    <div class="progress" aria-hidden="true"><span id="videoProgress"></span></div>
                    <div id="videoStatus" class="status"></div>
                </div>
            </div>

            <div class="row">
                <h2>Gửi vị trí</h2>
                <div class="stack">
                    <button id="btnSendLocation" class="btn">Gửi vị trí ghi nhận dữ liệu</button>
                    <div id="locStatus" class="status"></div>
                </div>
            </div>

            <div class="row">
                <h2>Cập nhật dữ liệu đã lưu</h2>
                <div class="stack">
                    <div>
                        <button id="btnBroadcastStored" class="btn">Cập nhật dữ liệu</button>
                        <span id="storedInfo" class="status" style="margin-left:8px"></span>
                    </div>
                </div>
            </div>

            <div class="row" id="trackingSection">
                <h2>Theo dõi vị trí liên tục</h2>
                <div class="stack">
                    <button id="btnToggleTracking" class="btn warn">Bật theo dõi vị trí</button>
                    <div>
                        <label><input type="checkbox" id="chkAutoSend" /> Tự động gửi vị trí lên server (mỗi 5 giây)</label>
                    </div>
                    <div id="trackStatus" class="status"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="panel-header">
                <h2>Chú thích mức ngập</h2>
            </div>
            <div class="legend">
                <div class="legend-item" data-range="0">
                    <div class="dot green"></div>
                    <div>
                        <div><strong>Mức 0</strong> — 0 cm (không ngập)</div>
                        <div class="tip">Hiển thị màu xanh lá</div>
                    </div>
                </div>
                <div class="legend-item" data-range="1-2">
                    <div class="dot yellow"></div>
                    <div>
                        <div><strong>Mức 1–2</strong> — 10–20 cm</div>
                        <div class="tip">Hiển thị màu vàng</div>
                    </div>
                </div>
                <div class="legend-item" data-range="3+">
                    <div class="dot red"></div>
                    <div>
                        <div><strong>Mức 3+</strong> — trên 20 cm</div>
                        <div class="tip">Hiển thị màu đỏ</div>
                    </div>
                </div>
            </div>
            <div style="margin-top:12px">
                <div class="tip">Nhấn vào một dòng để lọc bản đồ theo mức; nhấn "Xóa lọc" hoặc nhấn ra ngoài bản đồ để trở lại bình thường.</div>
            </div>
        </div>
    </div>

    <div class="card" style="margin-top:18px">
        <h2>Bản đồ (OpenStreetMap)</h2>
        <div id="map"></div>
        <div id="mapStatus" class="status" style="margin-top:10px"></div>
    </div>

    <template id="pulse-template"><div class="pulse-ring"></div></template>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script src="/js/app.js"></script>

    <!-- Overlay UI -->
    <div id="appOverlay" class="app-overlay" aria-hidden="true">
      <div class="overlay-box">
        <div class="spinner"></div>
        <div id="overlayTitle" class="overlay-title">Đang xử lý…</div>
        <div id="overlaySub" class="overlay-sub">Vui lòng đợi trong giây lát.</div>
      </div>
    </div>
</body>
</html>